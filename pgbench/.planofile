@command
def test(app):
    client_dir = get_real_path("client")

    with working_dir("server"):
        with start("plano run"):
            with working_dir(client_dir):
                run("plano run --duration 1")

@command
def special(app):
    run("kubectl config set-context --current --namespace bds")
    run("skupper delete")
    run("skupper init --routers 1 --router-cpu-limit 4")
    run("skupper token create /tmp/a.yaml")
    run("skupper expose deployment/pgbench-server --port 5432")
    run("skupper expose deployment/wrk-server --port 8080")

    sleep(10)

    run("kubectl config set-context --current --namespace bdc")
    run("skupper delete")
    run("skupper init --routers 1 --router-cpu-limit 4")
    run("skupper link create /tmp/a.yaml")

    sleep(60)

    run("kubectl run -it --rm --env BENCHDOG_HOST=pgbench-server --image quay.io/ssorj/benchdog-pgbench-client pgbench-client")
    run("kubectl run -it --rm --env BENCHDOG_HOST=wrk-server --image quay.io/ssorj/benchdog-wrk-client wrk-client")
